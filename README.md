# G20S Bluetooth Remote Linux Driver

If you are unfortunate enough to have spent $17 on a [G20S Bluetooth
remote][Amazon], you will encounter two problems.  First the device's
firmware produces a corrupt HID report, causing linux not to attach it
as an input device.  Second, if you work around the first problem,
you'll notice the OK key doesn't work when the air mouse is off,
because it's mapped to Select, which X11 doesn't consider a normal
key.

[Amazon]: https://www.amazon.com/Control-Wireless-Sensing-Android-Projector/dp/B0CYBG16GG

This driver works around the problem in two ways:

1. It uses a `report_fixup` method to substitute a valid HID report
   for the garbage returned by the remote's broken firmware.

2. It remaps the OK key to Enter when the air mouse is not enabled.

With these to fixes, the device is perfectly usable.

The substitute HID report and driver code were generated by Claude.AI.

This has been tested on arch linux with recent kernels.

## Installation

### Prerequisites

Install DKMS and kernel headers:

```bash
# Arch Linux
sudo pacman -S dkms linux-headers

# Ubuntu/Debian
sudo apt install dkms linux-headers-$(uname -r)

# Fedora
sudo dnf install dkms kernel-devel
```

### Quick Install

1. Checkout the git repository

2. Run the installation script:

```bash
sudo ./install.sh
```

### Manual Installation

1. Copy source files to DKMS directory:
```bash
sudo mkdir -p /usr/src/hid-g20s-1.0
sudo cp hid-g20s.c Makefile dkms.conf /usr/src/hid-g20s-1.0/
```

2. Install udev rules:
```bash
sudo cp 99-hid-g20s.rules /etc/udev/rules.d/
sudo udevadm control --reload-rules
```

3. Add to DKMS:
```bash
sudo dkms add -m hid-g20s -v 1.0
sudo dkms build -m hid-g20s -v 1.0
sudo dkms install -m hid-g20s -v 1.0
```

4. Load the module:
```bash
sudo modprobe hid-g20s
```

## Usage

After installation, pair your G20S remote with your system:

1. Put the remote in pairing mode (usually hold OK + Home buttons)
2. Use `bluetoothctl` to pair:
   ```bash
   bluetoothctl
   scan on
   pair [MAC_ADDRESS]
   connect [MAC_ADDRESS]
   trust [MAC_ADDRESS]
   ```

The driver will automatically load and the remote should work immediately.

### Check if driver is working
```bash
lsmod | grep hid_g20s
dmesg | grep g20s
```

### Test input events
```bash
sudo evtest
# Select G20S device and test buttons
```

## Uninstallation

```bash
sudo dkms remove hid-g20s/1.0 --all
sudo rm /etc/udev/rules.d/99-hid-g20s.rules
sudo rm -rf /usr/src/hid-g20s-1.0
sudo udevadm control --reload-rules
```

## Technical Details

The G20S remote ships with a truncated HID descriptor missing closing collection tags. This driver:

1. **Replaces the malformed descriptor** with a complete, valid one describing keyboard, mouse, and consumer control functionality
2. **Remaps KEY_SELECT to KEY_ENTER** for the OK button in non-air-mouse mode
3. **Uses DKMS** for automatic rebuilding across kernel updates

## Contributing

Found a bug or want to improve the driver? Contributions welcome!

## License

Public domain, all liability disclaimed.  Please see LICENSE file.
